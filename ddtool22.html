function detectAnomalies() {
  let anomalyCount = 0;
  let anomalyRows = [];

  let html = '<table><tr>';
  headers.forEach(h => html += `<th>${h}</th>`);
  html += '</tr>';

  rawData.forEach(row => {
    let isAnomaly = false;

    headers.forEach(h => {
      if (isNumericColumn(h)) {
        const nums = rawData.map(r => parseFloat(r[h]));
        const mean = nums.reduce((a,b)=>a+b,0)/nums.length;
        const sd = Math.sqrt(nums.reduce((a,b)=>a+Math.pow(b-mean,2),0)/nums.length);

        if (sd !== 0) {
          const z = (parseFloat(row[h]) - mean) / sd;
          if (Math.abs(z) >= 3) isAnomaly = true;
        }
      }
    });

    if (isAnomaly) {
      anomalyCount++;
      anomalyRows.push(row);
    }
  });

  // count display
  document.getElementById('totalCount').textContent = rawData.length;
  document.getElementById('anomalyCount').textContent = anomalyCount;

  // anomaly-only table
  anomalyRows.forEach(row => {
    html += '<tr class="highlight">';
    headers.forEach(h => html += `<td>${row[h]}</td>`);
    html += '</tr>';
  });

  html += '</table>';
  document.getElementById('anomalyTable').innerHTML = html;
}
